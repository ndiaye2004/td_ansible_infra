- name: Acte 1 - essai csr1000
  # On va agir sur l'hôte csr1000 dans cet acte
  hosts: csr1000
  # Passe l'étape permettant de récupérer des informations sur
  #   l'hôte pour gagner du temps
  gather_facts: false

  # Liste des tâches associées à notre Acte
  tasks:
    - name: conf_interfaces
      cisco.ios.ios_l3_interfaces:
        config:
          - name: GigabitEthernet2
            ipv4:
              - address: 192.168.2.1/24
          - name: GigabitEthernet3
            ipv4:
              - address: 192.168.3.1/24
          - name: GigabitEthernet4
            ipv4:
              - address: 192.168.4.1/24
        state: merged
  
    - name: conf_dhcp
      cisco.ios.ios_config:
        lines:
        - no ip dhcp pool dhcppool
        - ip dhcp pool dhcppool
        - network 192.168.2.0 255.255.255.0
        - default-router 192.168.2.1
        - exit
        - service dhcp
    - name: conf_nat_dynamique
      cisco.ios.ios_config:
        lines:
        - no ip access-list standard nat_acl
        - ip access-list standard nat_acl
        - permit 192.168.0.0 0.0.255.255
        - exit
        - interface GigabitEthernet1
        - ip nat outside
        - exit
        - interface GigabitEthernet2
        - ip nat inside
        - exit
        - interface GigabitEthernet3
        - ip nat inside
        - exit
        - interface GigabitEthernet4
        - ip nat inside
        - exit
        - ip nat inside source list nat_acl interface GigabitEthernet1 overload

    
- name: Sauvegarde config si modifiée
      cisco.ios.ios_config:
        save_when: modified
